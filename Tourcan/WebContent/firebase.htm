<html>
<head>
<title>Demo Site</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"
	async defer></script>
<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase-auth.js"></script>
<script>
	// Initialize Variable
	provider = null;
	user = null
	credential = null;
	error = null;

	// Initialize Firebase
	var config = {
		apiKey : "AIzaSyCBQ5sPydJ0xmpC9Evp8bWZu6O8LmJyuHw",
		authDomain : "tourcan-1373.firebaseapp.com",
		databaseURL : "https://tourcan-1373.firebaseio.com",
		storageBucket : "tourcan-1373.appspot.com",
	};
	firebase.initializeApp(config);

	$(function() {
		$(".signin-email").click(
			function() {
				firebase.auth().signInWithEmailAndPassword(
					$("#email").val(), $("#passwd").val()).then(
					function(result) {
						user = result;
						$("#errormsg").text("Welcome back, "+user.displayName);
					}, function(error) {
						console.log(error.email + ": " + error.code);
						$("#errormsg").text(error.code);
					}
				);
			}
		);
		$(".signin-google").click(function() {
			provider = new firebase.auth.GoogleAuthProvider();
			provider.addScope('email');
			provider.addScope('profile');
			firePopup();
		});
		$(".signin-facebook").click(function() {
			provider = new firebase.auth.FacebookAuthProvider();
			provider.addScope('email');
			provider.addScope('user_friends');
			firePopup();
		});
		$(".signout").click(function() {
			firebase.auth().signOut().then(function(){
				console.log("logout successful.");
				$("#errormsg").text("logout successful.");
			},function(){
				console.log("logout unsuccessful.");
				$("#errormsg").text("logout unsuccessful.");
			});
		});
	});

	function firePopup() {
		firebase.auth()
		.signInWithPopup(provider)
		.then(
			function(result) {
				user = result.user;
				credential = result.credential;
				$("#errormsg").text("Welcome back, "+user.displayName);
			},
			function(error) {
				console.log(error.email + ": " + error.code);
				$("#errormsg").text(error.code);
				var email = error.email;
				var credential = error.credential;
				if (error.code === 'auth/account-exists-with-different-credential') {
					auth.fetchProvidersForEmail(email)
					.then(
						function(providers) {
							if (providers[0] === 'password') {
								$("#email").val(email);
								return;
							}
							console.log("this email is used by other provider. if it's you, please try again.");
						}
					);
				}
			}
		);
	}

// 	firebase.auth().onAuthStateChanged(
// 		function(user) {
// 			if (user) {
// 				// User is signed in.
// 				// var id_token = firebase.User.getToken();
// 				user.getToken().then(
// 					function(id_token) {
// 						console.log('ID: ' + user.uid); // Do not send to your backend! Use an ID token instead.
// 						console.log('Name: ' + user.displayName);
// 						console.log('Image URL: ' + user.photoURL);
// 						console.log('Email: ' + user.email);
// 						console.log('id_token: ' + id_token);

// 						var xhr = new XMLHttpRequest();
// 						xhr.open('POST','http://localhost:8080/test_LoginAPI/FirebaseLogger');
// 						xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
// 						//xhr.onload = function() {console.log('Signed in as: ' + xhr.responseText);};
// 						xhr.send('idtoken=' + id_token);
// 					}
// 				);
// 			} else {
// 				// No user is signed in.
// 			}
// 		}
// 	);
</script>
<style>
.signin {
	width: 180px;
	height: 30px;
	border: 3px double orange;
	font-family: cursive;
	color: #FFFFFF;
	text-align: center;
}

.signin-email {
	background-color: #C0C0C0;
}
.signin-google {
	background-color: #c32f10;
}
.signin-facebook {
	background-color: #3b5998;
}
.signout {
	background-color: #000000;
}
</style>
</head>
<body>
	<input type="text" id="email">
	<input type="password" id="passwd">
	<div class="signin signin-email" id="signInWithEmail">Login with Email</div>
	<div class="signin signin-google" id="signInWithGoogle">Login with Google</div>
	<div class="signin signin-facebook" id="signInWithFacebook">Login with Facebook</div>
	<div class="signin signout" id="signout">Log me out</div>
	<div id="errormsg"></div>
</body>
</html>